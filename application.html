{% extends "base.html" %}
{% block content %}
<div class="container text-center">
  <h2 class="mb-4">Aplikasi Kalkulus dalam Dunia Nyata üåç</h2>

  <!-- Pilihan aplikasi -->
  <form id="appForm" class="mb-4">
    <label for="appSelect" class="form-label">Pilih contoh aplikasi:</label>
    <select id="appSelect" class="form-select mb-3">
      <option value="velocity">1Ô∏è‚É£ Kecepatan Benda Bergerak</option>
      <option value="growth">2Ô∏è‚É£ Pertumbuhan Populasi</option>
      <option value="area">3Ô∏è‚É£ Luas Area di Bawah Kurva</option>
      <option value="cost">4Ô∏è‚É£ Biaya Minimum Produksi</option>
      <option value="cooling">5Ô∏è‚É£ Pendinginan Suhu (Hukum Newton)</option>
    </select>

    <!-- Input parameter dinamis -->
    <div id="paramSection" class="mb-3"></div>

    <button type="submit" class="btn btn-custom">Tampilkan</button>
  </form>

  <div id="desc" class="mb-3 text-start"></div>
  <canvas id="appChart" height="100"></canvas>
</div>

<script>
const ctx = document.getElementById('appChart');
let chart;

// Fungsi untuk menampilkan input sesuai pilihan
function showParams(type) {
  const paramDiv = document.getElementById('paramSection');
  let html = '';

  if (type === 'velocity') {
    html = `
      <label>Rentang waktu (0 - ... detik):</label>
      <input type="number" id="tmax" class="form-control mb-2" value="10">
    `;
  } else if (type === 'growth') {
    html = `
      <label>Populasi awal (P‚ÇÄ):</label>
      <input type="number" id="P0" class="form-control mb-2" value="100">
      <label>Konstanta pertumbuhan (k):</label>
      <input type="number" step="0.1" id="k" class="form-control mb-2" value="0.3">
    `;
  } else if (type === 'area') {
    html = `
      <label>Batas bawah (a):</label>
      <input type="number" id="a" class="form-control mb-2" value="0">
      <label>Batas atas (b):</label>
      <input type="number" id="b" class="form-control mb-2" value="10">
    `;
  } else if (type === 'cost') {
    html = `
      <label>Koefisien a (x¬≤):</label>
      <input type="number" id="a" class="form-control mb-2" value="1">
      <label>Koefisien b (x):</label>
      <input type="number" id="b" class="form-control mb-2" value="-10">
      <label>Konstanta c:</label>
      <input type="number" id="c" class="form-control mb-2" value="30">
    `;
  } else if (type === 'cooling') {
    html = `
      <label>Suhu awal (T‚ÇÄ):</label>
      <input type="number" id="T0" class="form-control mb-2" value="100">
      <label>Suhu lingkungan (T_env):</label>
      <input type="number" id="Tenv" class="form-control mb-2" value="30">
      <label>Konstanta pendinginan (k):</label>
      <input type="number" step="0.1" id="k" class="form-control mb-2" value="0.2">
    `;
  }

  paramDiv.innerHTML = html;
}

// Tampilkan input pertama kali
showParams(document.getElementById('appSelect').value);

// Ganti input saat pilihan berubah
document.getElementById('appSelect').addEventListener('change', (e) => {
  showParams(e.target.value);
});

// Kirim data ke Flask
document.getElementById('appForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const app = document.getElementById('appSelect').value;
  const params = {};

  // ambil semua input di form
  document.querySelectorAll('#paramSection input').forEach(inp => {
    params[inp.id] = parseFloat(inp.value);
  });

  const res = await fetch('/application', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({type: app, params})
  });
  const data = await res.json();

  document.getElementById('desc').innerHTML = `<h5>${data.title}</h5><p>${data.desc}</p><p><b>Rumus:</b> ${data.formula}</p>`;

  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.x,
      datasets: [{
        label: data.label,
        data: data.y,
        borderColor: '#f48fb1',
        borderWidth: 3,
        fill: false
      }]
    }
  });
});
</script>
{% endblock %}
