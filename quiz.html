{% extends "base.html" %}
{% block content %}
<div class="container text-center">
  <h2 class="mb-4">ğŸ¯ Quiz Kalkulus Interaktif</h2>

  <div id="quiz-container" class="card p-4 shadow-sm" style="background-color:#fce4ec;">
    <div id="question" class="mb-3 fs-5 fw-bold text-primary"></div>
    <div id="options" class="d-grid gap-2"></div>
    <div id="feedback" class="mt-3 fw-semibold"></div>
    <button id="nextBtn" class="btn btn-custom mt-3" style="display:none;">Soal Berikutnya â¡ï¸</button>
  </div>

  <div id="result" class="mt-4 fs-4 fw-bold text-success" style="display:none;"></div>
</div>

<script>
let currentQuestion = 0;
let score = 0;
let quizData = [];

async function loadQuiz() {
  const res = await fetch('/quiz-data');
  quizData = await res.json();
  showQuestion();
}

function showQuestion() {
  const q = quizData[currentQuestion];
  document.getElementById('question').innerText = `Soal ${currentQuestion+1}: ${q.question}`;
  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML = '';
  document.getElementById('feedback').innerText = '';
  document.getElementById('nextBtn').style.display = 'none';

  q.options.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'btn btn-outline-primary';
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(opt);
    optionsDiv.appendChild(btn);
  });
}

function checkAnswer(answer) {
  const q = quizData[currentQuestion];
  const feedback = document.getElementById('feedback');
  if (answer === q.correct) {
    score++;
    feedback.innerHTML = "âœ… Benar!";
    feedback.style.color = 'green';
  } else {
    feedback.innerHTML = `âŒ Salah. Jawaban benar: ${q.correct}`;
    feedback.style.color = 'red';
  }
  document.querySelectorAll('#options button').forEach(btn => btn.disabled = true);
  document.getElementById('nextBtn').style.display = 'block';
}

document.getElementById('nextBtn').addEventListener('click', () => {
  currentQuestion++;
  if (currentQuestion < quizData.length) {
    showQuestion();
  } else {
    showResult();
  }
});

function showResult() {
  document.getElementById('quiz-container').style.display = 'none';
  document.getElementById('result').style.display = 'block';
  document.getElementById('result').innerText = `ğŸ‰ Kuis selesai! Skor kamu: ${score}/${quizData.length}`;
}

loadQuiz();
</script>
{% endblock %}
